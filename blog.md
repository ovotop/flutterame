è½¬è½½è¯·æ³¨æ˜å‡ºå¤„,ä¿æŒæ–‡ç« å®Œæ•´ï¼š
[Flutterç»„ä»¶åŒ–æ¡†æ¶](https://juejin.cn/editor/drafts/6911677421720698894)

# ç»„ä»¶åŒ–æ— å¤„ä¸åœ¨

![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6621c86e4965450298998c155305744d~tplv-k3u1fbpfcp-watermark.image)

å†›é˜Ÿä¸­æœ‰â€œå†›å¸ˆæ—…å›¢è¥â€ï¼Œè¥æ˜¯å›¢çš„ç»„ä»¶ï¼Œå¸ˆæ˜¯å†›çš„ç»„ä»¶ã€‚

å›½å®¶ä¸­æœ‰â€œçœå¸‚å¿ä¹¡æ‘â€ï¼Œæ‘æ˜¯ä¹¡çš„ç»„ä»¶ï¼Œå¸‚æ˜¯çœçš„ç»„ä»¶ã€‚

è¦ç®¡ç†å¤æ‚çš„ç»“æ„ï¼Œé€å±‚åˆ’åˆ†ç»„ä»¶æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„æ–¹æ³•ã€‚

æœ¬æ–‡æ¢è®¨çš„ç»„ä»¶åŒ–ï¼Œå¹¶éä»¥ä»£ç å¤ç”¨ä¸ºç›®çš„ã€‚

æœ¬æ–‡å…³æ³¨äºé€šè¿‡ç»„ä»¶åŒ–ï¼Œç®¡ç†æ¯”è¾ƒå¤æ‚çš„å·¥ç¨‹ï¼Œæé«˜äººæ•ˆï¼Œé™ä½æŸè€—ã€‚

# é—®é¢˜
å¤æ‚çš„å·¥ç¨‹å¾€å¾€å­˜åœ¨å¦‚ä¸‹ä¸¤ä¸ªä¸»è¦é—®é¢˜ï¼š
1. ä»£ç é‡å¤§ç¼–è¯‘æ…¢ã€‚
2. é€»è¾‘å¤æ‚éš¾ç»´æŠ¤ã€‚

# è§£å†³æ€è·¯

## åŒ–æ•´ä¸ºé›¶

è¯´åˆ°ä»£ç é£æ ¼ï¼Œå¾ˆå¤šäººéƒ½çŸ¥é“è¿™ä¸ªå¸¸è¯†ã€‚

å¦‚æœä¸€ä¸ªå‡½æ•°å¤ªé•¿äº†ï¼Œéœ€è¦æ‹†æˆä¸åŒå‡½æ•°ã€‚

å¦‚æœä¸€ä¸ªç±»å¤ªé•¿äº†ï¼Œéœ€è¦æ‹†æˆä¸åŒç±»ã€‚

å¦‚æœä¸€ä¸ªæ–‡ä»¶å¤ªé•¿äº†ï¼Œéœ€è¦æ‹†æˆä¸åŒæ–‡ä»¶ã€‚

åŒæ ·çš„ï¼Œå¦‚æœæˆ‘ä»¬çš„é¡¹ç›®å¤ªå¤§ï¼Œæ–‡ä»¶å¤ªå¤šï¼Œå°±éœ€è¦æ‹†åˆ†æˆä¸åŒçš„ç»„ä»¶äº†ã€‚

## å‡å°‘è€¦åˆ

å¦‚æœæ‹†æˆä¸åŒç»„ä»¶åï¼Œå„ä¸ªç»„ä»¶ä»ç„¶æœ‰åƒä¸ä¸‡ç¼•çš„è”ç³»ï¼Œç»´æŠ¤èµ·æ¥ä»ç„¶ä¼šä¸€å›¢ä¹±éº»ã€‚

æˆ‘ä»¬åº”å½“å°½é‡é¿å…ç»„ä»¶ä¹‹é—´çš„ä¾èµ–ã€‚å‡å°‘è€¦åˆã€‚

åˆ©ç”¨routerå¯ä»¥å¾ˆå¥½çš„è§£å†³é¡µé¢äº’ç›¸è·³è½¬æ—¶å¼•èµ·çš„è€¦åˆã€‚

åé¢å°†ä¼šæ¼”ç¤ºå¦‚ä½•åœ¨flutterä¸­å®ç°é€šè¿‡è·¯ç”±å‡å°‘è€¦åˆã€‚

## æ€æ ·ç»„ç»‡ä½ çš„ä»£ç å¤§å†›

ä¹‹å‰è§åˆ°è¿‡ä¸€å¥—Androidä»£ç â€œå……åˆ†â€åˆ©ç”¨äº†MVPæ¨¡å¼ã€‚
æ•´ä¸ªé¡¹ç›®ä¸‹é¢åˆ†äº†3ä¸ªç›®å½•ï¼ŒMï¼ŒVï¼ŒPã€‚
Vä¸‹é¢åˆåˆ† Activities,Views,Adapters,...

è™½ç„¶é€»è¾‘å’ŒUIåˆ†çš„å¾ˆå¼€ï¼Œä½†æ˜¯è¦ä¿®æ”¹ä¸€ä¸ªä¸šåŠ¡æˆ–è€…æ–°åŠ ä¸€å¥—åŠŸèƒ½ï¼Œéœ€è¦è·¨è¶Šå„ä¸ªç›®å½•ï¼Œé€ä¸€æ·»åŠ ä»£ç ã€‚

æˆ‘æ¯”è¾ƒæ¨èçš„æ˜¯ä¸‹é¢çš„åˆ’åˆ†æ–¹æ³•ï¼š
```
+------------------------------------------------+
|                    main frame                  |
|  +-----------+-----------+-----------+-----+   |
|  | business1 | business2 | business3 | ... |   |
+--+-----------+-----------+-----------+-----+---+
+------------------------------------------------+
|                   common                       |
+------------------------------------------------+
```
business1,business2,business3,...æ˜¯ä¸åŒçš„ä¸šåŠ¡æ¨¡å—ã€‚

ä¾‹å¦‚ï¼š ç”»å»Šï¼Œæœç´¢ï¼Œè¯¾ç¨‹ï¼Œæ¨è,....

è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œå½“ä½ æ·»åŠ ä»£ç çš„æ—¶å€™å¯ä»¥ä¸“æ³¨äºå½“å‰ä¸šåŠ¡ï¼Œ
å¿½ç•¥å…¶ä»–ä¸šåŠ¡æ¨¡å—ï¼Œå¤§å¤§å‡å°äº†éœ€è¦ç»´æŠ¤çš„ä»£ç çš„èŒƒå›´ã€‚

é€šå¸¸äº§å“éœ€æ±‚çš„å‘å±•å’Œå˜åŒ–ä¹Ÿæ˜¯æŒ‰ç…§ä¸šåŠ¡ä¸ºå•ä½è¿›è¡Œçš„ã€‚
æ¯”å¦‚äº§å“ç»ç†æƒ³åˆ°äº†ä¸€ç§æ–°çš„è¯¾ç¨‹æ¨¡å¼ï¼Œè¿™ä¸ªéœ€æ±‚å°†å½±å“åˆ°å’Œè¯¾ç¨‹ç›¸å…³çš„ä¸€äº›ä»£ç ã€‚
å¦‚æœæˆ‘ä»¬çš„ä»£ç æœ¬æ¥å°±å·²ç»å°†è¯¾ç¨‹ä¸šåŠ¡å°è£…åœ¨ä¸€èµ·çš„è¯ï¼Œä¿®æ”¹å°†éƒ½åœ¨è¿™ä¸ªæ¨¡å—å†…éƒ¨è¿›è¡Œã€‚è€Œä¸ä¼šæ ªè¿å…¶ä»–éƒ¨åˆ†çš„ä»£ç ã€‚

å½“ç„¶æˆ‘ä»¬ä¸æ˜¯ä¸è€ƒè™‘ä»£ç çš„å¤ç”¨ï¼Œé€šå¸¸æœ‰å¾ˆå¤šå€¼å¾—å¤ç”¨çš„ä»£ç éƒ½æ˜¯å’Œä¸šåŠ¡æ— å…³çš„ã€‚
å’Œä¸šåŠ¡æ— å…³ï¼Œä¹Ÿå°±æ˜¯è¯´ä¸ä¸“å±äºæŸä¸ªä¸šåŠ¡ï¼Œä¸šåŠ¡Aå¯èƒ½ä¼šç”¨åˆ°ï¼Œä¸šåŠ¡Bä¹Ÿå¯èƒ½ä¼šç”¨åˆ°ã€‚
è¿™äº›å¯å¤ç”¨çš„ä¸šåŠ¡æ— å…³çš„ä»£ç å°†ä¼šæ–¹é˜µä¸Šé¢æ¶æ„çš„commonéƒ¨åˆ†ã€‚


## æ€»ç»“ä¸€ä¸‹ï¼š
1. ä»¥ä¸šåŠ¡æ¨¡å—ä½œä¸ºæœ€åŸºç¡€çš„ä»£ç åˆ’åˆ†ï¼Œå°†ä¸šåŠ¡å˜åŒ–éš”ç¦»åœ¨ç›¸åº”çš„ç»„ä»¶å†…éƒ¨ã€‚
2. ä¸»æ¡†æ¶å’Œä¸šåŠ¡æ¨¡å—éƒ½ä¾èµ–çš„éƒ¨åˆ†ï¼Œæ”¾å…¥å…¬å…±åº“ã€‚(å…¬å…±åº“ä¸­éƒ½æ˜¯ä¸šåŠ¡æ— å…³ä»£ç )

# Flutterä¸­çš„å®è·µ

Flutterå¤©ç”Ÿå°±é€‚åˆç»„ä»¶åŒ–ï¼Œåªè¦ä½ ç ”ç©¶çš„è¶³å¤Ÿæ·±å…¥ï¼Œå°±èƒ½å‘ç°è¿™äº›ç‰¹å¾ï¼š
1. è‡ªå¸¦å·¥å…·å¯åˆ›å»ºç‹¬ç«‹è¿è¡Œç»„ä»¶ (modules)
2. è‡ªå¸¦è·¯ç”±æ”¯æŒ (router)
3. å¯é€šè¿‡å‘½ä»¤è¡Œç¯å¢ƒå˜é‡åŒºåˆ†appå’Œç»„ä»¶è¿è¡Œç¯å¢ƒ(commandline env)

åœ¨è¿™é‡Œæˆ‘ä¸“é—¨å†™äº†ä¸€å¥—æ¡†æ¶ç¤ºä¾‹ï¼š [Flutterame](https://github.com/ovotop/flutterame)

å‘½åå«ä¹‰ï¼šFlutterame = Flutter + Frame

## å‡†å¤‡

å·¥æ¬²å–„å…¶äº‹ï¼Œå¿…å…ˆåˆ©å…¶å™¨ã€‚

è®©æˆ‘ä»¬å…ˆå‡†å¤‡ä¸€ä¸‹.

### 1. åˆ›å»ºå·¥ç¨‹
flutter create  --org top.ovo --platforms ios,android flutterame

æƒ³è¦å­¦ä¹ flutter createçš„æ›´å¤šç”¨æ³•å¯ä»¥çœ‹ä¸€ä¸‹æˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« ï¼š[ç©è½¬flutter createå‘½ä»¤ï¼Œåš10å€ç¨‹åºå‘˜](https://juejin.cn/post/6844904106310500366)
å…¶ä¸­é™¤äº†æˆ‘å¯¹ flutter create --helpçš„ç¿»è¯‘è¿˜æœ‰ä¸€äº›å…¶ä»–çš„å¥‡æ€ªçš„å°æŠ€å·§ã€‚

### 2. é’ˆå¯¹å›½å†…ç½‘ç»œä¼˜åŒ–Androidç¼–è¯‘é€Ÿåº¦

#### 2.1 æ‰‹åŠ¨ä¿®æ”¹android/build.gradleæ–‡ä»¶ã€‚

ä¿®æ”¹å‰ï¼š
```gradle
    repositories {
        google()
        jcenter()
    }
```
ä¿®æ”¹åï¼š
```gradle
    repositories {
        maven { url 'https://maven.aliyun.com/repository/google'} // google()
        maven { url 'https://maven.aliyun.com/repository/jcenter'} // jcenter()
    }
```

#### 2.2 ç”¨è„šæœ¬ä¿®æ”¹
```
bin/optimize_cn_network.py android/
```
ç½‘é€Ÿä¼˜åŒ–è¯¦æƒ…è§ï¼š[Flutterå·¥ç¨‹çš„Androidç¼–è¯‘ç½‘é€Ÿä¼˜åŒ–](https://juejin.cn/post/6912647682343469070/)

å¥½äº†è¿™ä¸‹ä½ å¯ä»¥æ„‰å¿«çš„flutter runäº†ã€‚

å‡†å¤‡å·¥ä½œå®Œæˆï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç»„ä»¶ã€‚

## å¼€å§‹å®ç°ç»„ä»¶åŒ–

### 3. åˆ›å»ºç»„ä»¶

å‡å¦‚æˆ‘ä»¬è¦åœ¨é¡¹ç›®ä¸‹çš„modules/ç›®å½•ä¸‹åˆ›å»ºåä¸ºgalleryçš„æ¨¡å—ï¼Œæˆ‘ä»¬å¯ä»¥å…ˆè¿›å…¥modulesç›®å½•å†ç”¨flutter createåˆ›å»ºæ¨¡å—
```bash
flutter create -t module --org top.ovo gallery
```
è¿™é‡Œçš„-t moduleè¡¨ç¤ºè¦åˆ›å»ºçš„æ˜¯ä¸€ä¸ªç»„ä»¶è€Œä¸æ˜¯å®Œæ•´çš„appã€‚

åˆ›å»ºçš„ç»„ä»¶ç›®å½•å¦‚ä¸‹ï¼š

```
.
â”œâ”€â”€ .android
â”œâ”€â”€ .dart_tool
â”œâ”€â”€ .gitignore
â”œâ”€â”€ .ios
â”œâ”€â”€ .metadata
â”œâ”€â”€ .packages
â”œâ”€â”€ README.md
â”œâ”€â”€ build
â”œâ”€â”€ gallery.iml
â”œâ”€â”€ gallery_android.iml
â”œâ”€â”€ lib
â”‚Â Â  â””â”€â”€ main.dart
â”œâ”€â”€ pubspec.lock
â”œâ”€â”€ pubspec.yaml
â””â”€â”€ test
```
#### 3.1 ç»„ä»¶å¯ä»¥ç›´æ¥è¿è¡Œ
åœ¨å½“å‰ç»„ä»¶ç›®å½•ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥ç”¨flutter run è¿è¡Œè¿™ä¸ªç»„ä»¶ã€‚
ä¸ä¹…ä½ å°±èƒ½çœ‹åˆ°ç†Ÿæ‚‰çš„è®¡æ•°å™¨demoé¡µé¢ã€‚
å®ƒå’Œä¸€ä¸ªæ™®é€šçš„appæ²¡æœ‰å¤ªå¤§åŒºåˆ«ã€‚

![åˆšåˆ›å»ºå®Œçš„ç»„ä»¶è¿è¡Œçš„æ ·å­](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cb91dd0609a14a5cbe99d9d1864073b7~tplv-k3u1fbpfcp-watermark.image)

ç”±æ­¤å¯è§ï¼ŒFlutterçš„å¼€å‘è€…å……åˆ†è€ƒè™‘åˆ°äº†ç»„ä»¶åŒ–çš„éœ€æ±‚ã€‚ä½ ä¸ä½†å¯ä»¥æŠŠç»„ä»¶æ”¾åœ¨appä¸­è¿è¡Œï¼Œä¹Ÿå¯ä»¥å•ç‹¬è¿è¡Œç»„ä»¶ã€‚

#### 3.2 ç¥å¥‡çš„â€œ.androidâ€ å’Œ â€œ.iosâ€
å¦‚æœä½ ä»”ç»†è§‚å¯Ÿåˆ›å»ºå¥½çš„ç›®å½•ï¼Œä½ ä¼šå‘ç°ä¸€ä¸ªæœ‰è¶£çš„ç°è±¡ï¼š

åœ¨appä¸­androidå’Œiosç›®å½•ä¸è§äº†ã€‚å–è€Œä»£ä¹‹çš„æ˜¯ä¸¤ä¸ªéšè—ç›®å½• â€œ.androidâ€ å’Œ â€œ.iosâ€ã€‚

ä¹Ÿå°±æ˜¯è¯´è¿™ä¸¤ä¸ªç›®å½•æ˜¯éšè—çš„ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯ä¸ä¼šè¢«æ·»åŠ åˆ°gitä¸­çš„ã€‚
é‚£å¦‚æœå…¶ä»–äººæ‹‰å–äº†è¿™å¥—ä»£ç ï¼Œè¿˜èƒ½å•ç‹¬è¿è¡Œè¿™ä¸ªç»„ä»¶å—ï¼Ÿ

**ç»è¿‡å®éªŒå‘ç°ï¼š**

å¦‚æœåœ¨æ²¡æœ‰â€œ.androidâ€ å’Œ â€œ.iosâ€ç›®å½•çš„ç»„ä»¶ç›®å½•ä¸­è¿è¡Œflutter runçš„æ—¶å€™ã€‚

Flutterä¼šé‡æ–°åˆ›å»ºâ€œ.androidâ€ å’Œ â€œ.iosâ€ç›®å½•ã€‚

æ­£å› ä¸º.androidç›®å½•æ˜¯ä»£ç ç”Ÿæˆçš„ï¼Œä½ åœ¨é‡Œé¢æ‰€åšçš„ä¸€åˆ‡ä¿®æ”¹ï¼Œéšæ—¶å¯èƒ½ä¼šè¢«ä¸¢å¼ƒã€‚
å› æ­¤åœ¨æˆ‘çš„[Flutterå·¥ç¨‹çš„Androidç¼–è¯‘ç½‘é€Ÿä¼˜åŒ–](https://juejin.cn/post/6912647682343469070)ä¸€æ–‡ä¸­è¿˜ä»‹ç»äº†è„šæœ¬è‡ªåŠ¨ä¼˜åŒ–ç½‘é€Ÿï¼Œä»¥å…é™¤æ¯æ¬¡æ‰‹åŠ¨ä¿®æ”¹çš„éº»çƒ¦ã€‚

åˆ›å»ºå®Œç»„ä»¶å°±è¯¥ä½¿ç”¨äº†ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬ä¸€èµ·çœ‹çœ‹å¦‚ä½•ä½¿ç”¨ç»„ä»¶ä»£ç ã€‚

#### 3.3 åœ¨appä¸­åµŒå…¥ä½ çš„ç»„ä»¶ç•Œé¢ã€‚

##### 3.3.1 åˆ›å»ºç»„ä»¶ç•Œé¢

é¦–å…ˆæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç®€å•çš„ç»„ä»¶ç•Œé¢Galleriaï¼Œå°†å…¶å­˜æ”¾åœ¨ç»„ä»¶çš„gallria.dartæ–‡ä»¶ä¸­

modules/gallery/lib/gallria.dart:
```dart
import 'package:flutter/material.dart';

class Galleria extends StatelessWidget {
  const Galleria();

  @override
  Widget build(BuildContext context) {
    return Center(child: Text("Galleria"));
  }
}
```

##### 3.3.2 appä¸­æ·»åŠ å¯¹ç»„ä»¶å¯¹ä¾èµ–

æˆ‘ä»¬çš„appè¦è°ƒç”¨ç»„ä»¶ä¸­çš„ä»£ç ï¼Œéœ€è¦å…ˆå£°æ˜å¯¹ç»„ä»¶çš„ä¾èµ–ï¼š

æˆ‘ä»¬å¯ä»¥ä¿®æ”¹pubspec.yamlæ¥å®Œæˆè¿™ä¸ªå£°æ˜

ä¿®æ”¹å‰ï¼š
```yaml
dependencies:
  flutter:
    sdk: flutter

```

ä¿®æ”¹åï¼š
```yaml
dependencies:
  flutter:
    sdk: flutter
  gallery:
    path: modules/gallery
```
å¼ºè°ƒä¸€ä¸‹å› ä¸ºæˆ‘ä»¬çš„ç»„ä»¶ç›®å‰åœ¨æœ¬åœ°ï¼Œå› æ­¤éœ€è¦ç”¨ **pathï¼š+ç›¸å¯¹ç›®å½•** å£°æ˜è¿™ä¸ªä¾èµ–ã€‚

ä¿®æ”¹å®Œæˆåä½ å¯ä»¥æ‰§è¡Œï¼šflutter pub getæ¥å®Œæˆå®‰è£…ã€‚

å¦‚æœä½ ç”¨çš„æ˜¯vscode å½“ä½ ä¿®æ”¹å®Œpubspect.yamlåä¼šè‡ªåŠ¨æ‰§è¡Œâ€˜flutter pub getâ€™ã€‚
![](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5182ac2f4a554bb7969a738c5cf83526~tplv-k3u1fbpfcp-watermark.image)

##### 3.3.3 appä¸­å¼•ç”¨ç»„ä»¶ä¸­çš„ç±»

appä¸­å¯¼å…¥modules/gallery/lib/gallria.dartæ–‡ä»¶ï¼š

```dart
import 'package:gallery/galleria.dart';
import 'package:flutterame/mine.dart';


//...
const TabItems = {
  TabItem.galleria: {'icon': Icons.school, 'title': 'ç”»å»Š', 'widget': Galleria()},
  TabItem.mine: {'icon': Icons.more_horiz, 'title': 'æˆ‘çš„', 'widget': Mine()}
};
//...
```
åœ¨æˆ‘ä»¬çš„appä¸­æ·»åŠ äº†åº•éƒ¨tabï¼Œä½¿ç”¨äº†Galleria()æ¥åˆ›å»ºç»„ä»¶ä¸­çš„æ§ä»¶ã€‚

ä»”ç»†è§‚å¯Ÿä¸éš¾å‘ç°ï¼Œç»„ä»¶çš„å±‚çº§æ˜¯ç‹¬ç«‹çš„ï¼Œè€Œä¸æ˜¯åµŒå…¥åˆ°appä¸­ã€‚
```dart
import 'package:gallery/galleria.dart'; //è¿™å’Œflutterameæ²¡æœ‰åŠæ¯›é’±å…³ç³»ã€‚
import 'package:flutterame/mine.dart';
```

è¿™å¯¹æˆ‘ä»¬å°†æ¥å¤ç”¨ç»„ä»¶ä»£ç ä¹Ÿå¾ˆæœ‰åˆ©ã€‚

åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å®Œæˆäº†ä¸€ä¸ªæœ€ç²—ç•¥çš„ç»„ä»¶åŒ–ç¤ºä¾‹appã€‚

**æ¥å§ï¼Œå±•ç¤º**

å½“æˆ‘ä»¬åœ¨æ¨¡å—çš„ç›®å½•ä¸‹è¿è¡Œ"flutter run"çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°†ä¼šçœ‹åˆ°ç»„ä»¶å•ç‹¬è¿è¡Œçš„ç»“æœã€‚

å½“æˆ‘ä»¬åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹è¿è¡Œ"flutter run"çš„æ—¶å€™ï¼Œæˆ‘ä»¬å°†ä¼šçœ‹åˆ°æ•´ä¸ªappçš„è¿è¡Œç»“æœã€‚

ç»„ä»¶ä¸­è¿è¡Œ|appä¸­è¿è¡Œ
:----:|:----:
![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c3846f91f4734d05b766546c02a41b3b~tplv-k3u1fbpfcp-watermark.image)|![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5d5bd84863fb48689377fdf817f3d85c~tplv-k3u1fbpfcp-watermark.image)

**ç„¶è€Œäº‹æƒ…å¹¶æ²¡æœ‰ç»“æŸ**

æˆ‘åœ¨ç»„ä»¶ä¸­æ·»åŠ äº†jsonæ–‡ä»¶ä½œä¸ºæ˜¾ç¤ºç”¨çš„æ•°æ®ã€‚

ç»“æœå½“æˆ‘è¿è¡Œæ’ä»¶çš„æ—¶å€™ï¼Œä¸€åˆ‡æ­£å¸¸ã€‚

ä½†æ˜¯å½“æˆ‘è¿è¡Œæ•´ä¸ªappçš„æ—¶å€™å‘ç”Ÿäº†é”™è¯¯ã€‚

### 4. ç»„ä»¶ä¸­æ·»åŠ èµ„æº

äº‹æƒ…çš„ç»è¿‡æ—¶è¿™æ ·çš„ï¼š

é¦–å…ˆåœ¨ç»„ä»¶ç›®å½•ä¸‹åˆ›dataså»ºç›®å½•å¹¶æ·»åŠ èµ„æºæ–‡ä»¶:

modules/gallery/datas/gallery_source.json
```
.
â”œâ”€â”€ .android
â”œâ”€â”€ .ios
â”œâ”€â”€ datas
â”‚Â Â  â””â”€â”€ gallery_source.json
â”œâ”€â”€ lib
â”œâ”€â”€ pubspec.lock
â”œâ”€â”€ pubspec.yaml
â””â”€â”€ test
```

ç„¶åä¿®æ”¹modules/gallery/pubspec.yamlï¼Œæ·»åŠ assetså­—æ®µï¼š

ä¿®æ”¹å‰ï¼š
```yaml

flutter:
  uses-material-design: true

  # To add Flutter specific assets to your application, add an assets section,
  # like this:
  # assets:
  #   - images/a_dot_burr.jpeg
  #   - images/a_dot_ham.jpeg
```

ä¿®æ”¹åï¼š
```yaml

flutter:
  uses-material-design: true

  assets:
    - datas/gallery_source.json
```

åˆ©ç”¨DefaultAssetBundleåœ¨ä»£ç ä¸­å¼•ç”¨èµ„æºï¼š
```dart

  @override
  Widget build(BuildContext context) {
    return FutureBuilder(
        future: DefaultAssetBundle.of(context)
            .loadString('datas/gallery_source.json'),
        builder: (context, snapshot) {
          switch (snapshot.connectionState) {
            case ConnectionState.none:
            case ConnectionState.waiting:
              return Center(child: Text('Loading...'));
            default:
              if (snapshot.hasError)
                return Center(child: Text('Error: ${snapshot.error}'));
              else {
                //è‹¥_calculationæ‰§è¡Œæ­£å¸¸å®Œæˆ
                const json = const JsonCodec();
                var data = json.decode(snapshot.data.toString());
                return _buildLoaded(data);
              }
          }
        });
  }
```

#### 4.1 é—®é¢˜æ¥äº†

å½“æˆ‘å¯åŠ¨ç»„ä»¶çš„æ—¶å€™å¯ä»¥çœ‹åˆ°æ­£ç¡®ç»“æœï¼Œä½†æ˜¯åœ¨æˆ‘è¿è¡Œappæ˜¾ç¤ºç»„ä»¶ä¸­çš„é¡µé¢æ—¶å´æŠ¥é”™äº†ã€‚


ç»„ä»¶ä¸­è¿è¡Œ|appä¸­è¿è¡Œ
:----:|:----:
![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0ca9168a0f404022ab46ea9769289621~tplv-k3u1fbpfcp-watermark.image)|![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/16717c5dd3b341e6ac01db2cd9882df8~tplv-k3u1fbpfcp-watermark.image)

è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ

#### 4.2 æ¢ç´¢ç»“æœ

ç»è¿‡æ¢ç´¢å‘ç°ï¼Œappå’Œç»„ä»¶ä¸­çš„èµ„æºè¢«æ‰“åŒ…ä¹‹åçš„è·¯å¾„æ˜¯ä¸åŒçš„ã€‚
```
appä¸­èµ„æºï¼špackages/gallery/datas/gallery_source.json
ç»„ä»¶ä¸­èµ„æºï¼šdatas/gallery_source.json
```
å› æ­¤å½“æˆ‘ä»¬åœ¨æ’ä»¶ä¸­å¯ä»¥æ‰¾åˆ°èµ„æºæ–‡ä»¶ï¼Œä½†æ˜¯æ¢åˆ°appä¸­è¿è¡Œçš„æ—¶å€™å°±æ‰¾ä¸åˆ°äº†ã€‚

**æ¢ç´¢çš„è¿‡ç¨‹**ä¹Ÿä¸å¤æ‚ã€‚

æ‰¾åˆ°appå’Œæ’ä»¶çš„å®‰è£…åŒ…æŒ‰ç…§zipè§£å‹ã€‚

æ•´ä¸ªappçš„å®‰è£…åŒ…æ–‡ä»¶ç»“æ„ï¼š
build/app/outputs/apk/debug/app-debug.apkï¼š
```
.
â”œâ”€â”€ AndroidManifest.xml
â”œâ”€â”€ META-INF
â”œâ”€â”€ assets
â”‚Â Â  â””â”€â”€ flutter_assets
â”‚Â Â      â”œâ”€â”€ AssetManifest.json
â”‚Â Â      â”œâ”€â”€ FontManifest.json
â”‚Â Â      â”œâ”€â”€ NOTICES
â”‚Â Â      â”œâ”€â”€ fonts
â”‚Â Â      â”œâ”€â”€ isolate_snapshot_data
â”‚Â Â      â”œâ”€â”€ kernel_blob.bin
â”‚Â Â      â”œâ”€â”€ packages
â”‚Â Â      â”‚Â Â  â”œâ”€â”€ cupertino_icons
â”‚Â Â      â”‚Â Â  â””â”€â”€ gallery
â”‚Â Â      â”‚Â Â      â””â”€â”€ datas
â”‚Â Â      â”‚Â Â          â””â”€â”€ gallery_source.json
â”‚Â Â      â””â”€â”€ vm_snapshot_data
â”œâ”€â”€ classes.dex
â”œâ”€â”€ kotlin
â”œâ”€â”€ lib
â”œâ”€â”€ project.txt
â”œâ”€â”€ res
â””â”€â”€ resources.arsc
```

å•ä¸€ç»„ä»¶çš„å®‰è£…åŒ…æ–‡ä»¶ç»“æ„ï¼š
modules/gallery/build/host/outputs/apk/app.apkï¼š
```
.
â”œâ”€â”€ .DS_Store
â”œâ”€â”€ AndroidManifest.xml
â”œâ”€â”€ META-INF
â”œâ”€â”€ assets
â”‚Â Â  â”œâ”€â”€ .DS_Store
â”‚Â Â  â””â”€â”€ flutter_assets
â”‚Â Â      â”œâ”€â”€ AssetManifest.json
â”‚Â Â      â”œâ”€â”€ FontManifest.json
â”‚Â Â      â”œâ”€â”€ NOTICES
â”‚Â Â      â”œâ”€â”€ datas
â”‚Â Â      â”‚Â Â  â””â”€â”€ gallery_source.json
â”‚Â Â      â”œâ”€â”€ fonts
â”‚Â Â      â”œâ”€â”€ isolate_snapshot_data
â”‚Â Â      â”œâ”€â”€ kernel_blob.bin
â”‚Â Â      â”œâ”€â”€ packages
â”‚Â Â      â””â”€â”€ vm_snapshot_data
â”œâ”€â”€ classes.dex
â”œâ”€â”€ lib
â”œâ”€â”€ res
â””â”€â”€ resources.arsc
```

#### 4.3 è§£å†³æ–¹æ³•

ä¸€ç•ªç™¾è°·æ­Œåº¦ï¼Œå‚è€ƒäº†å‡ ç¯‡æ–‡ç« ä¹‹åï¼Œç»ˆäºæ‰¾åˆ°äº†è§£å†³æ–¹æ³•ã€‚

åˆ©ç”¨CommandArgument+bool.fromEnvironmentåŒºåˆ†ç¯å¢ƒã€‚

åŸæ¥fromEnvironmentå‡½æ•°ä¸ä»…å¯ä»¥åˆ¤æ–­æ˜¯å¦æ˜¯ç”Ÿäº§ç¯å¢ƒ,åƒè¿™æ ·:
```
final isProd = const bool.fromEnvironment('dart.vm.product');
```

è¿˜å¯ä»¥åˆ¤æ–­é€šè¿‡å‘½ä»¤è¡Œä¼ é€’ç»™flutter runå‘½ä»¤çš„å‚æ•°ã€‚

ç”¨æ³•å¦‚ä¸‹ï¼š

##### 4.3.1 åœ¨å‘½ä»¤è¡Œä¸­ä¼ é€’è‡ªå®šä¹‰å‚æ•°ï¼š
å¯åŠ¨ç»„ä»¶çš„æ—¶å€™ä¸ä»…ä»…ç”¨flutter run è¿˜è¦ç»™å®ƒä¼ é€’å‚æ•°
```bash
flutter run --dart-define=IS_RUN_ALONE=true
```
##### 4.3.2 åœ¨ä»£ç ä¸­åˆ¤æ–­ï¼š
```dart
class EnvironmentConfig {
  static const IS_RUN_ALONE =
      bool.fromEnvironment('IS_RUN_ALONE', defaultValue: false);
}
```
##### 4.3.3 æ ¹æ®ä¸åŒç¯å¢ƒåŠ è½½ä¸åŒèµ„æº
```dart
  @override
  Widget build(BuildContext context) {
    const isRunAlone = EnvironmentConfig.IS_RUN_ALONE;
    return FutureBuilder(
        future: DefaultAssetBundle.of(context).loadString(isRunAlone
            ? 'datas/gallery_source.json'
            : 'packages/gallery/datas/gallery_source.json'),
        builder: (context, snapshot) {
         //...
        });
  }
```
è¿™ä¸‹ç»ˆäºå®Œç¾äº†ï¼š
ç»„ä»¶ä¸­è¿è¡Œ|appä¸­è¿è¡Œ
:----:|:----:
![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0ca9168a0f404022ab46ea9769289621~tplv-k3u1fbpfcp-watermark.image)|![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4be8c4660cbd4df6a9e3c66dd45ca14a~tplv-k3u1fbpfcp-watermark.image)

ç»éªŒè¯è¿™å¥—æ–¹æ¡ˆåœ¨iosä¸Šä¹Ÿå¯ä»¥æ­£å¸¸å·¥ä½œã€‚

##### 4.3.4 å‚è€ƒæ–‡ç« ï¼š

[Flutter 1.17 â€” no more Flavors, no more iOS Schemas. Command argument that changes everything](https://itnext.io/flutter-1-17-no-more-flavors-no-more-ios-schemas-command-argument-that-solves-everything-8b145ed4285d)

[bool.fromEnvironment](https://api.flutter-io.cn/flutter/dart-core/bool/bool.fromEnvironment.html)

[String.fromEnvironment](https://api.flutter-io.cn/flutter/dart-core/String/String.fromEnvironment.html)

[int.fromEnvironment](https://api.flutter-io.cn/flutter/dart-core/int/int.fromEnvironment.html)


### 5. å¦‚ä½•è§£è€¦

ç»è¿‡åå‡ å¹´çš„æ‘¸çˆ¬æ»šæ‰“å‘ç°ï¼Œä»¥ä¸‹ä¸¤ç‚¹å¯ä»¥æœ‰æ•ˆçš„å‡å°‘è€¦åˆï¼š
1. æœç»ä»ç»„ä»¶ä¸­å¼•ç”¨æ¡†æ¶é‡Œçš„ä»£ç ã€‚
2. å°½é‡å‡å°‘ä»æ¡†æ¶ä¸­å¼•ç”¨ç»„ä»¶ä¸­çš„ä»£ç çš„å¼•ç”¨ã€‚

ä½ å¯ä»¥å¾ˆå®¹æ˜“çš„åšåˆ°ç¬¬ä¸€ç‚¹ï¼Œåªè¦ä½ çš„galleryæ¨¡å—ä¸­ä¸æ·»åŠ å¯¹Flutterameçš„ä¾èµ–å°±å¯ä»¥äº†ã€‚
å¦‚æœæœ‰ä¸€äº›ä»£ç ç¡®å®éœ€è¦åœ¨Flutterameå’Œgalleryä¹‹é—´å…¬ç”¨ï¼Œä¸å¦¨è€ƒè™‘å°†å…¶æ”¾å…¥å…¬å…±åº“ä¸­ã€‚
ç„¶ååœ¨Flutterameå’Œgalleryä¸­æ·»åŠ å¯¹å…¬å…±åº“çš„ä¾èµ–ã€‚

è¦åšåˆ°ç¬¬äºŒç‚¹ï¼Œä½ åˆ™éœ€è¦è€ƒè™‘æ¯ä¸€ä¸ªFlutterameä¸­æ¯ä¸€ä¸ªimport 'package:gallery/*.dart'æ˜¯å¦æ˜¯å¿…é¡»çš„ã€‚

ä¸¾ä¸ªä¾‹å­ï¼š
å‡å¦‚ä½ åœ¨Flutterameä¸­è¦è·³è½¬åˆ°galleryä¸­çš„ä¸€ä¸ªé¡µé¢AboutGalleryã€‚

ä½ å½“ç„¶å¯ä»¥ç›´æ¥è¿™æ ·å†™
```dart
Navigator.push(context, MaterialPageRoute(builder: (_) {
            return new AboutGallery();
          }));
```
#### é—®é¢˜ï¼š
è¿™æ ·ï¼Œä¸ºäº†èƒ½å¤Ÿåˆ›å»ºAboutGalleryï¼Œä½ è¿˜éœ€è¦åœ¨æ‰€æœ‰è°ƒç”¨è¿™ä¸ªè·³è½¬çš„åœ°æ–¹å¼•å…¥æ–‡ä»¶ 
```dart
import 'package:gallery/about.dart';
```
#### è§£å†³æ–¹æ³•ï¼š
ä½¿ç”¨è·¯ç”±ï¼Œå¦‚æœæˆ‘ä»¬ä½¿ç”¨pushNamedä»£æ›¿å°±å¯ä»¥å‡­å€Ÿè·¯ç”±è·³è½¬è€Œä¸å¿…å¯¼å…¥Widget
```dart
    // Navigator.push(context, MaterialPageRoute(builder: (BuildContext context) => GalleryAbout()));
    Navigator.pushNamed(context, "/gallery/about");
```
ä½†æ˜¯ä½¿ç”¨è·¯ç”±ä¹Ÿä¸æ˜¯è¿™ä¹ˆç®€å•ï¼Œéœ€è¦åšä¸€äº›å‡†å¤‡å·¥ä½œã€‚

#### 5.1 åœ¨ç»„ä»¶ä¸­åˆ›å»ºè·¯ç”±
åœ¨ç»„ä»¶modules/gallery/lib/ä¸­æ·»åŠ æ–‡ä»¶ routs.dart:
```dart
import 'package:flutter/material.dart';
import 'package:gallery/main.dart';
import 'package:gallery/detail.dart';
import 'package:gallery/about.dart';

class GalleryRouteGenerator {
  //é…ç½®è·¯ç”±
  static final routes = {
    "/": (context, {arguments}) => MyHomePage(title: 'ç”»å»Š'),
    "/gallery/detail": (context, {arguments}) => Detail(gallery: arguments),
    "/gallery/about": (context, {arguments}) => GalleryAbout(),
  };

  static Route<dynamic> generateRoute(RouteSettings settings) {
    final String name = settings.name;
    final Function pageContentBuilder = routes[name];
    if (pageContentBuilder != null) {
      final Route route = MaterialPageRoute(
          builder: (context) =>
              pageContentBuilder(context, arguments: settings.arguments));
      return route;
    } else {
      return _errorPage('æ‰¾ä¸åˆ°é¡µé¢');
    }
  }

  static Route _errorPage(msg) {
    return MaterialPageRoute(builder: (_) {
      return Scaffold(
          appBar: AppBar(title: Text('æœªçŸ¥é¡µé¢')), body: Center(child: Text(msg)));
    });
  }
}
```

#### 5.2 åœ¨ç»„ä»¶ä¸­ä½¿ç”¨è·¯ç”±
åœ¨ç»„ä»¶modules/gallery/lib/main.dartä¸­å¯¼å…¥æ–‡ä»¶ routs.dart:
```dart
import 'package:gallery/routes.dart';
//...
class MyApp extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Flutter Demo',
      theme: ThemeData(
        primarySwatch: Colors.blue,
      ),
      home: MyHomePage(title: 'Module: gallery'),
      initialRoute: '/',
      onGenerateRoute: GalleryRouteGenerator.generateRoute,
    );
  }
  //...
}
```
åˆ°ç›®å‰ä¸ºæ­¢ï¼Œç»„ä»¶ä¸­çš„è·¯ç”±å·²ç»å¯ä»¥å·¥ä½œäº†ã€‚



å¦‚æœæƒ³è¦åœ¨appä¸­ä½¿ç”¨è·¯ç”±è¿˜éœ€è¦ï¼Œåšä¸€ç‚¹ç‚¹å·¥ä½œã€‚

#### 5.3 åœ¨Appä¸­æ·»åŠ ç»„ä»¶è·¯ç”±

åœ¨appçš„ lib/ç›®å½•ä¸‹æ·»åŠ routs.dart:
```dart
import 'package:flutter/material.dart';
import 'package:flutterame/about.dart';
import 'package:flutterame/home.dart';

class RouteGenerator {
  //é…ç½®è·¯ç”±
  static final routes = {
    "/": (context, {arguments}) => MyHomePage(title: 'ç”»å»Š'),
    "/about": (context, {arguments}) => About(),
  };

  static Route<dynamic> generateRoute(RouteSettings settings) {
    final String name = settings.name;
    final Function pageContentBuilder = routes[name];
    if (pageContentBuilder != null) {
      final Route route = MaterialPageRoute(
          builder: (context) =>
              pageContentBuilder(context, arguments: settings.arguments));
      return route;
    } else {
      return _errorPage('æ‰¾ä¸åˆ°é¡µé¢');
    }
  }

  static Route _errorPage(msg) {
    return MaterialPageRoute(builder: (_) {
      return Scaffold(
          appBar: AppBar(title: Text('æœªçŸ¥é¡µé¢')), body: Center(child: Text(msg)));
    });
  }
}
```

åœ¨è¿™ä¸ªæ–‡ä»¶ä¸­æ·»åŠ ç»„ä»¶è·¯ç”±ï¼š
```dart
//...
import 'package:gallery/routes.dart';

class RouteGenerator {
  //é…ç½®è·¯ç”±
  static final routes = {
    ...GalleryRouteGenerator.routes,
    "/": (context, {arguments}) => MyHomePage(title: 'ç”»å»Š'),
    "/about": (context, {arguments}) => About(),
  };
  //...
}
```

...GalleryRouteGenerator.routesè¿™ä¸ªè¯­æ³•ï¼Œæˆ‘åœ¨ReactNativeä¸­ç»å¸¸ç”¨ï¼Œæ€€ç€è¯•ä¸€è¯•çš„æƒ³æ³•è¿è¡Œäº†ä¸€ä¸‹å±…ç„¶ç®¡ç”¨ï¼Œå¼€å¿ƒğŸ˜ŠğŸ˜ŠğŸ˜Š

è¿™ä¸‰ä¸ªç‚¹çš„æ„æ€æ˜¯ï¼Œå°†åé¢çš„å¯¹è±¡ï¼ˆGalleryRouteGenerator.routesï¼‰æ‹†å¼€ï¼Œåˆå¹¶åˆ°æ–°çš„å¯¹è±¡ï¼ˆRouteGenerator.routesï¼‰ä¸­ã€‚

#### 5.4 åœ¨Appä¸­ä½¿ç”¨ç»„ä»¶è·¯ç”±

åœ¨lib/mine.dartæ–‡ä»¶ä¸­è°ƒç”¨ï¼š
```dart
Navigator.pushNamed(context, "/gallery/about")
```
Navigatorä¼šæ‹¿ç€ "/gallery/about"å»appçš„è·¯ç”±é‡Œé¢æ‰¾Widgetã€‚æ‰¾åˆ°ä¹‹åå°±è·³è½¬åˆ°é‚£ä¸ªé¡µé¢å»äº†ã€‚

æ”¶å·¥ï¼Œå®Œæ•´çš„ä»£ç åœ¨githubä¸Šï¼š [Flutterame](https://github.com/ovotop/flutterame)

#### åˆåˆ°äº†å±•ç¤ºç¯èŠ‚

##### ç»„ä»¶ä¸­ä½¿ç”¨è·¯ç”±
æˆ‘ä»¬å…ˆè¿›å…¥modules/gallery/å¯åŠ¨ç»„ä»¶ï¼š
```bash
flutter run --dart-define=IS_RUN_ALONE=true
```
å½“æˆ‘ä»¬ç‚¹å‡»å›¾ç‰‡å°é¢çš„æ—¶å€™ï¼Œä¼šè¿›å…¥è¯¦æƒ…é¡µé¢ã€‚ç‚¹å‡»å³ä¸‹è§’â€œAboutâ€æŒ‰é’®è¿›å…¥ç»„ä»¶çš„å…³äºé¡µé¢æ˜¾ç¤ºäº†â€œabout galleryâ€ã€‚

##### appä¸­ä½¿ç”¨è·¯ç”±
æ¥ä¸‹æ¥æˆ‘ä»¬å›åˆ°é¡¹ç›®æ ¹ç›®å½• é€šè¿‡flutter run å¯åŠ¨æ•´ä¸ªappã€‚

åœ¨ç¬¬ä¸€ä¸ªtabä¸­ç‚¹å‡»å›¾ç‰‡å°é¢ï¼Œè¿›å…¥äº†ç»„ä»¶ä¸­çš„è¯¦æƒ…é¡µã€‚è¿™é‡Œè¿ç”¨äº†Flutterç‰¹æœ‰çš„Heroç»„ä»¶å®ç°äº†è·¨å±åŠ¨ç”»ï¼Œå–œæ¬¢ğŸ˜ğŸ˜ğŸ˜

åœ¨ç¬¬äºŒä¸ªtabä¸­ç‚¹å‡»â€œaboutâ€è¿›å…¥appçš„å…³äºé¡µé¢ã€‚

åœ¨ç¬¬äºŒä¸ªtabä¸­ç‚¹å‡»â€œgallery aboutâ€ è¿›å…¥ç»„ä»¶çš„å…³äºé¡µé¢ã€‚

ç»„ä»¶ä¸­è¿è¡Œ|appä¸­è¿è¡Œ
:----:|:----:
![ç»„ä»¶ä¸­è¿è¡Œ](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/35b40ebeee444c54b8854a03035d0cc6~tplv-k3u1fbpfcp-watermark.image)|![appä¸­è¿è¡Œ](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5ba9e299253d4979ab846fcba185733b~tplv-k3u1fbpfcp-watermark.image)


<br><br><br><br><br>

â­ï¸|â­ï¸â­ï¸â­ï¸|â­ï¸
----:|:----:|:----
â­ï¸ |![çœ¼å·´å·´ç›¼ç€ä½ ç‚¹èµ](https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8a54462fedea49eaad84c2ab6e97aa23~tplv-k3u1fbpfcp-watermark.image)| â­ï¸
â­ï¸ |**æœ¬æ–‡ä½œè€…æ­£çœ¼å·´å·´ç›¼ç€ä½ è½¬å‘ã€ç‚¹èµã€åŠ å…³æ³¨**| â­ï¸